<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial, sans-serif; background-color: #f8f9fa; }
      .container { padding: 20px; }
      label { display: block; margin-top: 15px; margin-bottom: 5px; color: #333; font-weight: bold; }
      select { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; background-color: white; }
      button { padding: 10px 15px; border: none; border-radius: 4px; background-color: #4285f4; color: white; cursor: pointer; font-size: 14px; margin-top: 20px;}
      button:hover { background-color: #357ae8; }
      .info { margin-top: 15px; color: #555; }
      .note { font-size: 12px; color: #666; margin-top: 25px; border-top: 1px solid #ddd; padding-top: 15px; }
    </style>
  </head>
  <body>
    <div class="container">
      <label for="template">Select Email Template</label>
      <select id="template"></select>

      <label for="role">Filter by Role (Category)</label>
      <select id="role"></select>

      <label for="status">Filter by Status</label>
      <select id="status"></select>

      <div class="note">
        <b>Note:</b> Email templates can be edited in the "Config" sheet. Use {{name}} as a placeholder for the recipient's name.
      </div>

      <button onclick="send()">Send Emails</button>
      
      <div id="status-info" class="info"></div>
    </div>

    <script>
      // Populate dropdowns on load
      window.onload = function() {
        google.script.run.withSuccessHandler(populateDropdowns).getEmailUIData();
      };

      function populateDropdowns(data) {
        const templateSelect = document.getElementById('template');
        const roleSelect = document.getElementById('role');
        const statusSelect = document.getElementById('status');

        data.templates.forEach(t => templateSelect.add(new Option(t, t)));
        data.roles.forEach(r => roleSelect.add(new Option(r, r)));
        data.statuses.forEach(s => statusSelect.add(new Option(s, s)));
      }

      // Send the email data to the server
      function send() {
        const statusDiv = document.getElementById('status-info');
        statusDiv.innerHTML = "Sending emails...";
        
        const filters = {
          template: document.getElementById('template').value,
          role: document.getElementById('role').value,
          status: document.getElementById('status').value
        };
        
        google.script.run.withSuccessHandler(function(response) {
          statusDiv.innerHTML = response;
        }).sendEmails(filters);
      }
    </script>
  </body>
</html>

